# Webアプリ仕様メモ

## 概要
- 目的: 2024年10月27日時点の衆議院勢力を基に、政党の組み合わせで過半数(233/465議席)到達可否を検証するモバイル特化Webアプリを構築する。
- 想定利用者: 政治記者・研究者・一般市民。タッチ操作を主とする。
- 対象デバイス: 幅360px以上のスマートフォン表示を前提。

## データ設定
- データソース: NHK報道「2024年10月27日衆議院総選挙結果」(最終更新: 2025-10-10時点で確認)。
- 議席総数: 465。
- 過半数ライン: 233。

| ID | 政党名 | 略称 | 議席数 | カラー |
| --- | --- | --- | --- | --- |
| ldp | 自由民主党 | 自民 | 191 | #E60026 |
| komeito | 公明党 | 公明 | 24 | #F8B500 |
| cdp | 立憲民主党 | 立民 | 148 | #004098 |
| ishin | 日本維新の会 | 維新 | 38 | #6DB33F |
| dpp | 国民民主党 | 国民 | 28 | #00418B |
| reiwa | れいわ新選組 | れいわ | 9 | #FF0080 |
| jcp | 日本共産党 | 共産 | 8 | #E60012 |
| sdp | 社会民主党 | 社民 | 1 | #1B62B9 |
| sanseito | 参政党 | 参政 | 3 | #F37021 |
| japan-conservative | 日本保守党 | 保守 | 3 | #0F3B63 |
| independent | 無所属 | 無所属 | 12 | #666666 |

## 初期グループ構成
- 与党: 自由民主党のみ。
- 野党: 立憲民主党、日本共産党、社会民主党。
- その他: 上記以外の政党および無所属。
- グループ/政党データは `src/data/parties.ts` に静的定義。

## UI・レイアウト
- 画面は3本の縦棒グラフ(与党/野党/その他)を横並びに配置。各棒は議席数比率で高さを表現し、横スクロール不要。各グループ内はバー領域(横幅約50%)とツールチップ領域(約50%)の2カラム構成。
- 上部固定ヘッダで与党合計議席、過半数までの差分を表示。検索バーやモード切り替えボタンを配置予定。
- 議席数に比例した高さの積み木状ブロックで構成し、公称カラーを適用。
- 21議席以上はブロック内部に政党名と議席数を表示し、20議席以下は右側の常時表示ツールチップへ退避。
- ツールチップは接続ライン付きで縦方向に位置を調整し、独自アルゴリズムで完全に重なりを排除。

## ドラッグ&ドロップ仕様
- ライブラリ: `@dnd-kit/core` と `@dnd-kit/sortable`。
- 政党ブロックをドラッグして別グループに移動、または同一グループ内で並び替え可能。
- ドラッグ中は `DragOverlay` を表示し、挿入候補位置に半透明プレビューを描画。
- タッチ操作向けにPointerSensorへpress delay導入。代替としてタップ選択→移動先選択の操作も提供。
- ドロップ完了後に合計議席と過半数判定を再計算。

## ツールチップ処理
- ライブラリ: `@floating-ui/react` (コンポーネント化予定)。
- 小政党の情報ラベルを常時表示する固定ツールチップとして活用し、接続ラインで対応ブロックと関連付け。
- 複数ツールチップの縦位置を計算し、一定間隔を確保することで重なりを防止。

## 状態管理・技術スタック
- フロントエンド: React + Vite + TypeScript (既存構成をReact19へ合わせる)。
- グローバル状態: Zustandで `parties`/`groups` を管理し、派生selectorで合計計算。
- 付随ライブラリ: `@floating-ui/react`、将来的に `@dnd-kit/modifiers` などを検討。

## アクセシビリティ
- グループコンテナにARIAロール`list`、政党ブロックに`listitem`。
- キーボードでの移動操作補助とフォーカスインジケータを実装。
- 色覚多様性対応として、必要に応じてパターンオーバーレイをオプション提供。

## 非対応・非機能要件
- 分析ログ収集やURL共有機能は実装対象外。
- データ更新は現状値を固定。補欠選挙や解散への対応は範囲外。

## 実装フェーズ
1. **データセット整備**: 政党・カラー・議席数JSON/型定義作成。(完了)
2. **プロジェクトセットアップ**: 主要ライブラリ導入と土台構築。(完了)
3. **基本レイアウト**: モバイル前提の3カラムレイアウトと共通スタイル整備。
4. **政党ブロック描画**: 積み上げ棒のスケーリング、ラベル/ツールチップ条件実装。
5. **ドラッグ&ドロップ統合**: dnd kit導入、挿入プレビュー、状態更新。
6. **補助UI実装**: サマリー、検索、タップ代替操作の実装。
7. **アクセシビリティと仕上げ**: ARIA、フォーカス、配色調整、パフォーマンス最適化。
8. **テストと検証**: 単体・結合テスト、Playwrightでモバイル操作確認。

## 進捗
- Step1/8 完了 (データセット整備)。
- Step2/8 完了 (主要ライブラリ導入・TypeScript移行)。
- Step3/8 完了 (基本レイアウト作成)。
- Step4/8 完了 (政党ブロック描画)。
